<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>00 Git, Github, and Slack</title>
    <meta charset="utf-8" />
    <meta name="author" content="STAT 406" />
    <meta name="author" content="Daniel J. McDonald" />
    <script src="materials/libs/header-attrs/header-attrs.js"></script>
    <script src="https://kit.fontawesome.com/ae71192e04.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="materials/xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="materials/slides-style.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# 00 Git, Github, and Slack
]
.author[
### STAT 406
]
.author[
### Daniel J. McDonald
]
.date[
### Last modified - 2022-09-07
]

---





## Course communication

**Website:**

&lt;https://ubc-stat.github.io/stat-406/&gt;

* Hosted on Github.

* Links to slides and all materials

* Syllabus is there. Be sure to read it.


**Slack:**

* Link to join on Canvas. This is our discussion board.

* Note that this data is hosted on servers outside of Canada. You may wish to use a pseudonym to protect your privacy.

* Anything super important will be posted to Slack and Canvas. 

* Be sure you get Canvas email.

* If I am sick, I will cancel class or arrange a substitute.

---

**Github organization**

* Linked from the website.

* This is where you complete/submit assignments/projects/in-class-work

* This is also hosted on Servers outside Canada &lt;https://github.com/stat-406-2022w/&gt;

---

## Why these?

* Yes, some data is hosted on servers in the US.

* But in the real world, no one uses Canvas / Piazza, so why not learn things they do use?

* Much easier to communicate, "mark" or comment on your work

* Much more DS friendly

* Note that MDS uses both of these, the Stat and CS departments use both, many faculty use them, Google / Amazon / Facebook use things like these, etc.

--

Slack help from MDS [features](https://ubc-mds.github.io/resources_pages/slack/) and [rules](https://ubc-mds.github.io/resources_pages/slack_asking_for_help/)

---
class: middle, center, inverse

# Git and Github

---


## Why version control?

.center[

![:scale 30%](http://www.phdcomics.com/comics/archive/phd101212s.gif)

]

* Much of this lecture is borrowed/stolen from Colin Rundel and Karl Broman

---

## Why version control?

* Simple formal system for tracking all changes to a project

* Time machine for your projects
    + Track blame and/or praise
    + Remove the fear of breaking things

* Learning curve is steep, but when you need it you REALLY need it

&gt; Your closest collaborator is you six months ago, but you don’t reply to emails.
&gt; -- _Paul Wilson_

---

## Why Git?

.pull-left[
* You could use something like Box or Dropbox

* These are poor-man's version control

* Git is much more appropriate

* It works with large groups

* It's very fast

* It's much better at fixing mistakes

* Tech companies use it (so it's in your interest to have some experience)

.emphasis[

This will hurt, but what doesn't kill you, 

makes you stronger.
]
]

.pull-right[

![](https://imgs.xkcd.com/comics/git.png)

]




---

## Overview


* `git` is a command line program that lives on your machine

* If you want to track changes in a directory, you type `git init`

* This creates a (hidden) directory called `.git`

* The `.git` directory contains a history of all changes made to "versioned" files

* This top directory is referred to as a "repository" or "repo"

* `github.com` is a service that hosts a repo  remotely and has other features: issues, project boards, pull requests, renders `.ipynb` &amp; `.md`

* Some IDEs (pycharm, RStudio, VScode) have built in `git` 

* `git`/`github.com` is broad and complicated. Here, just what you **need**

---

## Aside on built-in / command line

.emphasis[
First things first, RStudio and the Terminal
]


* Command line is the "old" type of computing. You type commands at a prompt and the computer "does stuff". 

* You may not have seen where this is. RStudio has one built in called "Terminal"

* The Mac System version is also called "Terminal". If you have a Linux machine, this should all be familiar.

* Windows is not great at this.

* To get the most out of Git, you have to use the command line.

* We'll practice this in the Lab next week.

* But, if everything goes right, you can do everything you need directly from RStudio point + click.

---

## Typical workflow for doing stuff (command line)


.pull-left[
1. Download a repo from Github
```bash
git clone https://github.com/stat-406-2022W/labs-dajmcdon.git
```
2. Create a **branch**
```bash
git branch &lt;branchname&gt;
```
3. Make changes to your files.
4. Add your changes to be tracked ("stage" them)
```bash
git add &lt;name/of/tracked/file&gt;
```
5. Commit your changes
```bash
git commit -m "Some explanatory message"
```


**Repeat 3--5 as needed. Once you're satisfied**

* Push to Github
```bash
git push
git push -u origin &lt;branchname&gt;
```
]

.pull-right[.center[
&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;

![:scale 90%](gfx/git-clone.png)
]]


---
## What should be tracked?

**Definitely** code, markdown documentation, tex files, bash scripts/makefiles, ...

**Possibly** logs, jupyter notebooks, images (that won’t change), ...

**Questionable** processed data, static pdfs, ...

**Definitely not** full data, continually updated pdfs (other things compiled from source code), ...

---

## What things to track



* You decide what is "versioned". 

* A file called `.gitignore` tells `git` files or types to never track

```bash
# History files
.Rhistory
.Rapp.history

# Session Data files
.RData

# User-specific files
.Ruserdata
```

* Shortcut to track everything (use carefully):

```bash
git add .
```




---

## Rules


### Homework and Labs

* You each have your own repo

* You make a branch

* .secondary.hand[DO NOT] rename files

* Make enough commits (3 for labs, 5 for HW).

* Push your changes (at anytime) and make a PR against `main` when done.

* TAs review your work.

* On HW, if you want to revise, make changes in response to feedback and push to the same branch.


---

## What's a PR?

* This exists on Github (not git)

* Demonstration

--

.pull-left[.center[
![:scale 100%](gfx/pr1.png)
]]

.pull-right[.center[
![:scale 80%](gfx/pr2.png)
]]

---

## Some things to be aware of

* `master` vs `main`

* If you think you did something wrong, stop and ask for help

* There are guardrails in place. But those won't stop a bulldozer.

* The hardest part is the initial setup. Then, this should all be rinse and repeat.

* This book is great: [Happy Git with R](https://happygitwithr.com)
    1. See Chapter 6 if you have install problems.
    1. See Chapter 10 for credential caching (avoid typing a password all the time)
    1. See Chapter 13 if RStudio can't find `git`
    

---

## The `main/develop/branch` workflow

* When working on your own
    1. Don't NEED branches.
    1. I often make a branch if I want to try a modification without breaking what I have.
    1. Otherwise, can "pretend `git` is Dropbox": work on `main`, make changes and commits, sync to remote for backup purposes.
    
--
    
* When working on a large team with production grade software
    1. `main` is protected, released version of software (maybe renamed to `release`)
    1. `develop` contains things not yet on `main`, but thoroughly tested
    1. On a schedule (once a week, once a month) `develop` gets merged to `main`
    1. You work on a `feature` branch off `develop` to build your new feature
    1. You do a PR against `develop`. Supervisors review your contributions
    
--

I and many DS/CS/Stat faculty use this workflow with my lab.
    
--

### Protection

* Typical for your PR to trigger tests to make sure you don't break things
* Typical for team members or supervisors to review your PR for compliance


---

## Guardrails

* The `.github` directory contains interactions with Github

    1. Actions: On push / PR / other Github does something on their server (builds a website, runs tests on code)
    1. PR templates: Little admonitions when you open a PR
    1. Branch protection: prevent you from doing stuff
    
* In this course, I protect `main` so that you can't push there

.emphasis[
If you try to push to `main`, it will give an error like
```bash
remote: error: GH006: Protected branch update failed for refs/heads/main.
```
]

* I also use a PR template. It gives you some instructions that you should follow

--

.alert[
Read the PR template!!
]


---

## Operations in Rstudio 

1. Stage
1. Commit
1. Push
1. Pull
1. Create a branch

--

.emphasis[
Covers:
* Everything to do your HW / Labs if you're careful
* Plus most other things you "want to do"
]

--

#### Command line versions (of the same)

```bash
git add &lt;name/of/file&gt;
git commit -m "some useful message"
git push
git pull
git checkout -b &lt;name/of/branch&gt;

```

---

## Other useful stuff (but command line only)

.pull-left[
.primary[Initializing]
```bash
git config user.name --global "Daniel J. McDonald"
git config user.email --global "daniel@stat.ubc.ca"
git config core.editor --global nano 
# or emacs or ... (default is vim)
```


.primary[Staging]
```bash
git add name/of/file # stage 1 file
git add . # stage all
```

.primary[Committing]
```bash
# stage/commit simultaneously
git commit -am "message" 

# open editor to write long commit message
git commit 
```

.primary[Pushing]
```bash
# If branchname doesn't exist
# on remote, create it and push
git push -u origin branchname
```
]

.pull-right[
.primary[Branching]
```bash
# switch to branchname, error if uncommitted changes
git checkout branchname 
# switch to a previous commit
git checkout aec356

# create a new branch
git branch newbranchname

# create a new branch and check it out
git checkout -b newbranchname

# merge changes in branch2 onto branch1
git checkout branch1
git merge branch2

# grab a file from branch2 and put it on current
git checkout branch2 -- name/of/file

git branch -v # list all branches
```

.primary[Check the status]
```bash
git status
git remote -v # list remotes
git log # show recent commits, msgs
```


]

---

## Conflicts

Sometimes you merge things and "conflicts" happen.

Meaning that changes on one branch would overwrite changes on a different branch.

They look like this.

```bash
Here are lines that are either unchanged from the common
ancestor, or cleanly resolved because only one side changed.

But below we have some troubles
&lt;&lt;&lt;&lt;&lt;&lt;&lt; yours:sample.txt
Conflict resolution is hard;
let's go shopping.
=======
Git makes conflict resolution easy.
&gt;&gt;&gt;&gt;&gt;&gt;&gt; theirs:sample.txt

And here is another line that is cleanly resolved or unmodified.
```

You get to decide, do you want to keep

1. Your changes (above `======`)
2. Their changes (below `======`)
3. Both.
4. Neither.

But always delete the `&lt;&lt;&lt;&lt;&lt;`, `======`, and `&gt;&gt;&gt;&gt;&gt;` lines.

---

## Some other pointers

* Commits have long names: `32b252c854c45d2f8dfda1076078eae8d5d7c81f`

* If you want to use it, you need "enough to be unique": `32b25`

* Online help uses directed graphs in ways different from statistics:
    * In stats, arrows point from cause to effect, forward in time
    * In git docs, it's reversed, they point to the thing on which they depend
    
    
### Cheat sheet

&lt;https://training.github.com/downloads/github-git-cheat-sheet.pdf&gt;


---

## How to undo in 3 scenarios

* Suppose we're concerned about a file named `README.md`
* Often, `git status` will give some of these as suggestions

.pull-left[
**1.** Saved but not staged
* In RStudio, select the file and click <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:blue;overflow:visible;position:relative;"><path d="M495.9 166.6C499.2 175.2 496.4 184.9 489.6 191.2L446.3 230.6C447.4 238.9 448 247.4 448 256C448 264.6 447.4 273.1 446.3 281.4L489.6 320.8C496.4 327.1 499.2 336.8 495.9 345.4C491.5 357.3 486.2 368.8 480.2 379.7L475.5 387.8C468.9 398.8 461.5 409.2 453.4 419.1C447.4 426.2 437.7 428.7 428.9 425.9L373.2 408.1C359.8 418.4 344.1 427 329.2 433.6L316.7 490.7C314.7 499.7 307.7 506.1 298.5 508.5C284.7 510.8 270.5 512 255.1 512C241.5 512 227.3 510.8 213.5 508.5C204.3 506.1 197.3 499.7 195.3 490.7L182.8 433.6C167 427 152.2 418.4 138.8 408.1L83.14 425.9C74.3 428.7 64.55 426.2 58.63 419.1C50.52 409.2 43.12 398.8 36.52 387.8L31.84 379.7C25.77 368.8 20.49 357.3 16.06 345.4C12.82 336.8 15.55 327.1 22.41 320.8L65.67 281.4C64.57 273.1 64 264.6 64 256C64 247.4 64.57 238.9 65.67 230.6L22.41 191.2C15.55 184.9 12.82 175.3 16.06 166.6C20.49 154.7 25.78 143.2 31.84 132.3L36.51 124.2C43.12 113.2 50.52 102.8 58.63 92.95C64.55 85.8 74.3 83.32 83.14 86.14L138.8 103.9C152.2 93.56 167 84.96 182.8 78.43L195.3 21.33C197.3 12.25 204.3 5.04 213.5 3.51C227.3 1.201 241.5 0 256 0C270.5 0 284.7 1.201 298.5 3.51C307.7 5.04 314.7 12.25 316.7 21.33L329.2 78.43C344.1 84.96 359.8 93.56 373.2 103.9L428.9 86.14C437.7 83.32 447.4 85.8 453.4 92.95C461.5 102.8 468.9 113.2 475.5 124.2L480.2 132.3C486.2 143.2 491.5 154.7 495.9 166.6V166.6zM256 336C300.2 336 336 300.2 336 255.1C336 211.8 300.2 175.1 256 175.1C211.8 175.1 176 211.8 176 255.1C176 300.2 211.8 336 256 336z"/></svg> <svg aria-hidden="true" role="img" viewBox="0 0 320 512" style="height:1em;width:0.62em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M310.6 246.6l-127.1 128C176.4 380.9 168.2 384 160 384s-16.38-3.125-22.63-9.375l-127.1-128C.2244 237.5-2.516 223.7 2.438 211.8S19.07 192 32 192h255.1c12.94 0 24.62 7.781 29.58 19.75S319.8 237.5 310.6 246.6z"/></svg> then select <svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:red;overflow:visible;position:relative;"><path d="M480 256c0 123.4-100.5 223.9-223.9 223.9c-48.86 0-95.19-15.58-134.2-44.86c-14.14-10.59-17-30.66-6.391-44.81c10.61-14.09 30.69-16.97 44.8-6.375c27.84 20.91 61 31.94 95.89 31.94C344.3 415.8 416 344.1 416 256s-71.67-159.8-159.8-159.8C205.9 96.22 158.6 120.3 128.6 160H192c17.67 0 32 14.31 32 32S209.7 224 192 224H48c-17.67 0-32-14.31-32-32V48c0-17.69 14.33-32 32-32s32 14.31 32 32v70.23C122.1 64.58 186.1 32.11 256.1 32.11C379.5 32.11 480 132.6 480 256z"/></svg> Revert...
```bash
# grab the previously committed version
git checkout -- README.md 
```

**2.** Staged but not committed
* In RStudio, uncheck the box by the file, then use the method above.
```bash
# unstage
git reset HEAD README.md
git checkout -- README.md
```
]

.pull-right[

**3.** Committed
* Not easy to do in RStudio...
```bash
# check the log to see where you made the chg, 
git log
# go one step before that (eg to 32b252)
# and grab that earlier version
git checkout 32b252 -- README.md
```
```bash
# alternatively
# if it happens to also be on another branch
git checkout otherbranch -- README.md
```
]

---

## Recovering from things

1. Accidentally did work on main, Tried to Push but got refused
```bash
# make a new branch with everything, but stay on main
git branch newbranch
# find out where to go to
git log
# undo everything after ace2193
git reset --hard ace2193
git checkout newbranch
```

2. Made a branch, did lots of work, realized it all s**ks
```bash
git checkout main
git branch -d badbranch
```

3. Anything more complicated, either post to Slack or LMGTFY

4. In the Lab next week, you'll practice 
    * Doing it right.
    * Recovering from some mistakes.
    
---

# Example of setting up labs

* Cloning your repo.

* Creating a branch.

* Knitting the Rmd.

* Where to put answers.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="materials/macros.js"></script>
<script>var slideshow = remark.create({
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
